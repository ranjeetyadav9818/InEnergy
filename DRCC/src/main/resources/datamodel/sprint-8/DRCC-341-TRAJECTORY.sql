DROP TABLE IF EXISTS AWARD_TRAJECTORY;

CREATE TABLE `AWARD_TRAJECTORY` (
  `ID`      BIGINT(20) NOT NULL AUTO_INCREMENT,
  `UUID`    VARCHAR(55)         DEFAULT NULL,
  `DISPATCH_BATCH_ID` bigint(20) UNSIGNED NOT NULL,
  `DOP` bigint(20) NOT NULL,
  `TARGET_TIME` DATETIME NOT NULL,
  `SEQUENCE_NUMBER` VARCHAR(255),
  `CONFIGURATION_ID` VARCHAR(255),
  `DOP_UID` VARCHAR(255),
  PRIMARY KEY (`ID`),
  CONSTRAINT `TRAJECTORY_BATCH_FK`
  FOREIGN KEY (`DISPATCH_BATCH_ID`)
  REFERENCES `DISPATCH_BATCH` (`ID`)
    ON DELETE CASCADE
    ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE AWARD_INSTRUCTION DROP FOREIGN KEY FK_INSTRUCTION;
ALTER TABLE AWARD_INSTRUCTION DROP COLUMN EVENT_ID;

ALTER TABLE EVENT DROP COLUMN DISPATCH_STATUS;
ALTER TABLE EVENT ADD COLUMN DISPATCH_BATCH_ID bigint(20) UNSIGNED;
ALTER TABLE EVENT ADD CONSTRAINT `EVENT_BATCH_FK` FOREIGN KEY (`DISPATCH_BATCH_ID`)
  REFERENCES `DISPATCH_BATCH` (`ID`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE AWARD_TRAJECTORY ADD COLUMN RESOURCE_ID bigint(20) UNSIGNED NOT NULL;
ALTER TABLE AWARD_TRAJECTORY ADD CONSTRAINT `TRAJECTORY_RESOURCE_FK` FOREIGN KEY (`RESOURCE_ID`)
  REFERENCES `ISO_RESOURCE` (`ID`) ON DELETE CASCADE ON UPDATE CASCADE;